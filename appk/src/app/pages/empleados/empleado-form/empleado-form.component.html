<form [formGroup]="empleadoForm" (ngSubmit)="onSubmit()" class="empleado-form">
  <h2>{{ mode === 'create' ? 'Agregar' : 'Editar' }} Empleado</h2>
<mat-dialog-content>
    <mat-tab-group>
      <!-- Información Personal -->
      <mat-tab label="Información Personal">
      <div class="tab-content full-width">
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Nombre</mat-label>
          <input matInput formControlName="nombre" required>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>RFC</mat-label>
          <input matInput formControlName="rfc" required>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>CURP</mat-label>
          <input matInput formControlName="curp" required>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" required type="email">
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Teléfono</mat-label>
          <input matInput formControlName="telefono" required>
        </mat-form-field>
      </div>
      </mat-tab>

    <!-- Información Laboral -->
      <mat-tab label="Información Laboral">
      <div class="tab-content full-width">
        <mat-form-field appearance="fill">
          <mat-label>Puesto</mat-label>
          <input matInput formControlName="puesto" required>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Departamento</mat-label>
          <input matInput formControlName="departamento">
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width date-field">
          <mat-label>Fecha de Inicio</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="fechaInicio" required>
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </div>
      </mat-tab>

    <!-- Información Salarial -->
      <mat-tab label="Información Salarial">
      <div class="tab-content full-width">
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Salario Base</mat-label>
          <input matInput formControlName="salarioBase" required type="number">
        </mat-form-field>
      </div>
      </mat-tab>

    <!-- Tab de Deducciones -->
<mat-tab label="Deducciones">
  <div class="tab-content" formArrayName="deducciones">
    <table mat-table [dataSource]="deduccionesDataSource" class="full-width">
      <!-- Columna Tipo (ahora solo lectura) -->
      <ng-container matColumnDef="tipo">
        <th mat-header-cell *matHeaderCellDef>Tipo</th>
        <td mat-cell *matCellDef="let control; let i = index">
          <mat-form-field appearance="outline">
            <input matInput [formControl]="control.get('tipo')" placeholder="Tipo" readonly>
          </mat-form-field>
        </td>
      </ng-container>

      <!-- Columna Clave - AHORA CON MAT-SELECT -->
      <ng-container matColumnDef="clave">
        <th mat-header-cell *matHeaderCellDef>Clave</th>
        <td mat-cell *matCellDef="let control; let i = index">
          <mat-form-field appearance="outline">
            <mat-label>Seleccione</mat-label>
            <mat-select 
              [formControl]="control.get('clave')" 
              (selectionChange)="onDeduccionClaveChange(i, $event.value)"
              [disabled]="isLoadingCatalogos">
              <mat-option *ngFor="let deduccion of catalogoDeducciones" [value]="deduccion.c_TipoDeduccion">
                {{ deduccion.c_TipoDeduccion }} - {{ deduccion.descripcion }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </td>
      </ng-container>

      <!-- Columna Concepto (autocompletado) -->
      <ng-container matColumnDef="concepto">
        <th mat-header-cell *matHeaderCellDef>Concepto</th>
        <td mat-cell *matCellDef="let control; let i = index">
          <mat-form-field appearance="outline">
            <input matInput [formControl]="control.get('concepto')" placeholder="Concepto" readonly>
          </mat-form-field>
        </td>
      </ng-container>

      <!-- Columna Importe Gravado -->
      <ng-container matColumnDef="importeGravado">
        <th mat-header-cell *matHeaderCellDef>Importe Gravado</th>
        <td mat-cell *matCellDef="let control; let i = index">
          <mat-form-field appearance="outline">
            <input matInput type="number" [formControl]="control.get('importeGravado')" placeholder="0.00">
          </mat-form-field>
        </td>
      </ng-container>

      <!-- Columna Importe Exento -->
      <ng-container matColumnDef="importeExento">
        <th mat-header-cell *matHeaderCellDef>Importe Exento</th>
        <td mat-cell *matCellDef="let control; let i = index">
          <mat-form-field appearance="outline">
            <input matInput type="number" [formControl]="control.get('importeExento')" placeholder="0.00">
          </mat-form-field>
        </td>
      </ng-container>

      <!-- Columna Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let control; let i = index">
          <button mat-icon-button color="warn" (click)="eliminarDeduccion(i)" type="button">
            <mat-icon>close</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <button mat-raised-button color="primary" (click)="agregarDeduccion()" class="mt-3" type="button">
      Agregar Deducción
    </button>
  </div>
</mat-tab>

    <!-- Percepciones -->
      <mat-tab label="Percepciones">
  <div class="tab-content" formArrayName="percepciones">
    <table mat-table [dataSource]="percepcionesDataSource" class="full-width">
      <!-- Columna Tipo (solo lectura) -->
      <ng-container matColumnDef="tipo">
        <th mat-header-cell *matHeaderCellDef>Tipo</th>
        <td mat-cell *matCellDef="let control; let i = index">
          <mat-form-field appearance="outline">
            <input matInput [formControl]="control.get('tipo')" placeholder="Tipo" readonly>
          </mat-form-field>
        </td>
      </ng-container>

      <!-- Columna Clave - AHORA CON MAT-SELECT -->
      <ng-container matColumnDef="clave">
        <th mat-header-cell *matHeaderCellDef>Clave</th>
        <td mat-cell *matCellDef="let control; let i = index">
          <mat-form-field appearance="outline">
            <mat-label>Seleccione</mat-label>
            <mat-select 
              [formControl]="control.get('clave')" 
              (selectionChange)="onPercepcionClaveChange(i, $event.value)"
              [disabled]="isLoadingCatalogos">
              <mat-option *ngFor="let percepcion of catalogoPercepciones" [value]="percepcion.c_TipoPercepcion">
                {{ percepcion.c_TipoPercepcion }} - {{ percepcion.descripcion }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </td>
      </ng-container>

      <!-- Columna Concepto (autocompletado) -->
      <ng-container matColumnDef="concepto">
        <th mat-header-cell *matHeaderCellDef>Concepto</th>
        <td mat-cell *matCellDef="let control; let i = index">
          <mat-form-field appearance="outline">
            <input matInput [formControl]="control.get('concepto')" placeholder="Concepto" readonly>
          </mat-form-field>
        </td>
      </ng-container>

      <!-- Columna Importe Gravado -->
      <ng-container matColumnDef="importeGravado">
        <th mat-header-cell *matHeaderCellDef>Importe Gravado</th>
        <td mat-cell *matCellDef="let control; let i = index">
          <mat-form-field appearance="outline">
            <input matInput type="number" [formControl]="control.get('importeGravado')" placeholder="0.00">
          </mat-form-field>
        </td>
      </ng-container>

      <!-- Columna Importe Exento -->
      <ng-container matColumnDef="importeExento">
        <th mat-header-cell *matHeaderCellDef>Importe Exento</th>
        <td mat-cell *matCellDef="let control; let i = index">
          <mat-form-field appearance="outline">
            <input matInput type="number" [formControl]="control.get('importeExento')" placeholder="0.00">
          </mat-form-field>
        </td>
      </ng-container>

      <!-- Columna Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let control; let i = index">
          <button mat-icon-button color="warn" (click)="eliminarPercepcion(i)" type="button">
            <mat-icon>close</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <button mat-raised-button color="primary" (click)="agregarPercepcion()" class="mt-3" type="button">
      Agregar Percepción
    </button>
  </div>
</mat-tab>
    </mat-tab-group>
 </mat-dialog-content>

  <mat-dialog-actions>
    <button mat-raised-button class="btn-primary" type="submit">Guardar</button>
    <button mat-button (click)="onCancel()" class="btn-danger" type="button">Cancelar</button>
  </mat-dialog-actions>
  
</form>